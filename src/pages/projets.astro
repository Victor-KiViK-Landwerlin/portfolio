---
// src/pages/projets.astro
import Layout from '../layouts/Layout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import { getProjects, pb } from '../lib/pocketbase';

// Récupérer les projets depuis PocketBase
const projects = await getProjects();

// Fallback si PocketBase n'est pas configuré
const fallbackProjects = [
  {
    id: "1",
    title: "INKSPIRE",
    slug: "inkspire",
    image: "/images/inkspire.jpg",
    tags: ["Design", "Branding"]
  },
  {
    title: "FAMILLE D'HIER",
    slug: "famille-dhier",
    image: "/images/famille-dhier.jpg",
    tags: ["Webdesign", "Editorial"]
  },
  {
    title: "LAZYDOCS",
    slug: "lazydocs",
    image: "/images/lazydocs.jpg",
    tags: ["UI/UX", "App"]
  },
  {
    title: "IJF",
    slug: "ijf",
    image: "/images/ijf.jpg",
    tags: ["Branding", "Identity"]
  }
];

// Utiliser PocketBase si disponible, sinon fallback
const displayProjects = projects.length > 0 ? projects : fallbackProjects;
---

<Layout title="Projets" currentPath="/projets">
  <!-- Titre de la page -->
  <section class="py-5">
    <div class="container mx-auto max-w-6xl">
      <h1 class="text-8xl font-bold text-kivik-green text-center mb-8">
        Projets
      </h1>
    </div>
  </section>

  <!-- Liste des projets -->
  <section class="py-12 px-6 pb-20">
    <div class="container mx-auto max-w-6xl">
      <h2 class="text-4xl font-bold text-kivik-green mb-12 text-center">Mes projets</h2>
      
      {displayProjects.length === 0 ? (
        <div class="text-center py-20">
          <p class="text-2xl text-kivik-green/60">Aucun projet disponible pour le moment.</p>
          <p class="mt-4 text-kivik-green/40">Configure PocketBase pour afficher tes projets !</p>
        </div>
      ) : (
        <div class="grid md:grid-cols-2 gap-8 mb-12">
          {displayProjects.map((project) => {
            // Obtenir l'URL de l'image correctement
            let imageUrl = '/images/placeholder.jpg';
            
            if (project.image) {
              if (project.id && project.collectionId) {
                // Image depuis PocketBase
                imageUrl = `http://127.0.0.1:8090/api/files/${project.collectionId}/${project.id}/${project.image}`;
              } else {
                // Image locale (fallback)
                imageUrl = project.image;
              }
            }
            
            return (
              <ProjectCard 
                title={project.title}
                image={imageUrl}
                slug={project.slug}
                tags={project.tags || []}
              />
            );
          })}
        </div>
      )}

      <div class="text-center">
        <a 
          href="/contact"
          class="inline-block px-8 py-3 bg-white border-2 border-kivik-green text-kivik-green font-medium rounded-none hover:bg-kivik-green hover:text-white transition-colors"
        >
          me contacter
        </a>
      </div>
    </div>
  </section>
</Layout>