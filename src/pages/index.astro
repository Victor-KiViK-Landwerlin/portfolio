---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import ProjectCard from '../components/ProjectCard.astro';
import Logo from '../components/Logo.astro';
import { getProjects, pb } from '../lib/pocketbase';

// Récupérer les 2 projets les plus récents
const allProjects = await getProjects();
const recentProjects = allProjects.slice(0, 2);

// Fallback si PocketBase n'est pas configuré
const fallbackProjects = [
  {
    id: null,
    title: "INKSPIRE",
    slug: "inkspire",
    image: "/images/inkspire.jpg",
    tags: ["Design", "Branding"]
  },
  {
    id: null,
    title: "FAMILLE D'HIER",
    slug: "famille-dhier",
    image: "/images/famille-dhier.jpg",
    tags: ["Webdesign", "Editorial"]
  }
];

const displayProjects = recentProjects.length > 0 ? recentProjects : fallbackProjects;
---

<Layout title="Accueil" currentPath="/">
 <!-- Hero Section -->
<section 
  class="relative min-h-[70vh] flex flex-col items-center justify-center px-6 overflow-hidden"
>

  <!-- WATERMARK CENTRÉ EXACTEMENT -->
  <img 
    src="/watermark.svg"
    alt=""
    class="absolute
           w-[180%] opacity-20 pointer-events-none z-10"
  />

  <!-- Victor -->
  <h1 class="text-7xl font-bold text-kivik-green mb-4">
    Victor
  </h1>

  <!-- KiViK EXACTEMENT COMME TA MAQUETTE -->
  <div class="text-[6rem] font-bold tracking-wide leading-none">
    <span class="text-kivik-light -mr-7">KiVi</span>
    <span class="text-kivik-green">KiViK</span>
    <span class="text-kivik-light -ml-7">iViK</span>
  </div>

  <!-- Landwerlin -->
  <h2 class="text-5xl font-bold text-kivik-green mt-4">
    Landwerlin
  </h2>

  <!-- baseline -->
  <p class="mt-6 text-xl text-kivik-green/80">
    Identité visuelle · Webdesign · Datavisualisation
  </p>

</section>



  <!-- Présentation -->
  <section class="py-20 px-6">
    <div class="container mx-auto max-w-6xl">
      <h2 class="text-4xl font-bold text-kivik-green mb-8 text-center">Présentation</h2>
      
      <div class="grid md:grid-cols-2 gap-12 items-center">
        <!-- Logo -->
        <div class="flex justify-center">
          <Logo size="xlarge" animated={true} />
        </div>

        <!-- Texte de présentation -->
        <div class="space-y-4 text-lg">
          <p class="text-kivik-green">
            Je m'appelle Victor Landwerlin, aka <span class="font-bold">KiViK</span>.
          </p>
          <p class="text-kivik-green">
            Mon terrain de jeu : l'identité visuelle, le webdesign et la dataviz.
          </p>
          <p class="text-kivik-green">
            J'explore comment donner du sens aux formes, aux couleurs et aux chiffres.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Projets récents -->
  <section class="py-20 px-6 bg-white/30">
    <div class="container mx-auto max-w-6xl">
      <h2 class="text-4xl font-bold text-kivik-green mb-12 text-center">Projets récents</h2>
      
      {displayProjects.length === 0 ? (
        <div class="text-center py-20">
          <p class="text-2xl text-kivik-green/60">Aucun projet disponible.</p>
          <p class="mt-4 text-kivik-green/40">Configure PocketBase pour afficher tes projets !</p>
        </div>
      ) : (
        <>
          <div class="grid md:grid-cols-2 gap-8 mb-12">
            {displayProjects.map((project) => {
              // Obtenir l'URL de l'image correctement
              let imageUrl = '/images/placeholder.jpg';
              
              if (project.image) {
                if (project.id && project.collectionId) {
                  // Image depuis PocketBase
                  imageUrl = `http://127.0.0.1:8090/api/files/${project.collectionId}/${project.id}/${project.image}`;
                } else {
                  // Image locale (fallback)
                  imageUrl = project.image;
                }
              }
              
              return (
                <ProjectCard 
                  title={project.title}
                  image={imageUrl}
                  slug={project.slug}
                  tags={project.tags || []}
                />
              );
            })}
          </div>

          <div class="text-center">
            <a 
              href="/projets"
              class="inline-block px-8 py-3 bg-white border-2 border-kivik-green text-kivik-green font-medium rounded-none hover:bg-kivik-green hover:text-white transition-colors"
            >
              voir plus
            </a>
          </div>
        </>
      )}
    </div>
  </section>
</Layout>